/**
 * Dynamic Content Styles
 *
 * Styles for dynamic code block content:
 * - canvas-roots-timeline
 * - canvas-roots-relationships
 * - canvas-roots-media
 */

/* ==========================================================================
   Dynamic Block Base
   ========================================================================== */

.cr-dynamic-block {
  padding: var(--cr-spacing-md);
  margin: var(--cr-spacing-sm) 0;
  border: 1px solid var(--background-modifier-border);
  border-radius: var(--cr-radius-md);
  background: var(--background-primary);
}

.cr-dynamic-block--error {
  border-color: var(--color-red);
  background: var(--background-modifier-error);
}

.cr-dynamic-block__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--cr-spacing-sm);
  padding-bottom: var(--cr-spacing-sm);
  border-bottom: 1px solid var(--background-modifier-border);
}

.cr-dynamic-block__title {
  font-weight: var(--font-semibold);
  font-size: var(--font-ui-medium);
  color: var(--text-normal);
}

.cr-dynamic-block__toolbar {
  display: flex;
  gap: var(--cr-spacing-xs);
}

.cr-dynamic-block__btn {
  padding: var(--cr-spacing-xs);
  border: none;
  background: transparent;
  cursor: pointer;
  border-radius: var(--cr-radius-sm);
  font-size: var(--font-ui-small);
  opacity: 0.6;
  transition: opacity 0.15s ease;
}

.cr-dynamic-block__btn:hover {
  opacity: 1;
  background: var(--background-modifier-hover);
}

.cr-dynamic-block__content {
  font-size: var(--font-ui-small);
}

.cr-dynamic-block__empty {
  color: var(--text-muted);
  font-style: italic;
  text-align: center;
  padding: var(--cr-spacing-md);
}

.cr-dynamic-block__error-message {
  color: var(--color-red);
  padding: var(--cr-spacing-sm);
}

/* ==========================================================================
   Timeline Block
   ========================================================================== */

.cr-timeline__list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.cr-timeline__item {
  display: flex;
  flex-wrap: wrap;
  align-items: baseline;
  padding: var(--cr-spacing-xs) 0;
  border-bottom: 1px solid var(--background-modifier-border-hover);
}

.cr-timeline__item:last-child {
  border-bottom: none;
}

.cr-timeline__year {
  font-weight: var(--font-semibold);
  color: var(--text-accent);
  min-width: 50px;
}

.cr-timeline__separator {
  color: var(--text-muted);
  margin: 0 var(--cr-spacing-xs);
}

.cr-timeline__title {
  color: var(--text-normal);
}

.cr-timeline__title a {
  color: var(--text-accent);
  text-decoration: none;
}

.cr-timeline__title a:hover {
  text-decoration: underline;
}

.cr-timeline__place {
  color: var(--text-muted);
  font-size: var(--font-ui-smaller);
}

/* ==========================================================================
   Relationships Block
   ========================================================================== */

.cr-relationships__section {
  margin-bottom: var(--cr-spacing-md);
}

.cr-relationships__section:last-child {
  margin-bottom: 0;
}

.cr-relationships__heading {
  font-size: var(--font-ui-small);
  font-weight: var(--font-semibold);
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 0 0 var(--cr-spacing-xs) 0;
  padding: 0;
}

.cr-relationships__list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.cr-relationships__item {
  display: flex;
  align-items: baseline;
  padding: var(--cr-spacing-xs) 0;
}

.cr-relationships__link a {
  color: var(--text-accent);
  text-decoration: none;
}

.cr-relationships__link a:hover {
  text-decoration: underline;
}

.cr-relationships__name {
  color: var(--text-normal);
}

.cr-relationships__dates {
  color: var(--text-muted);
  font-size: var(--font-ui-smaller);
  margin-left: var(--cr-spacing-xs);
}

/* ==========================================================================
   Media Gallery Block
   ========================================================================== */

.cr-dynamic-block__icon {
  display: inline-flex;
  align-items: center;
  margin-right: var(--cr-spacing-xs);
  opacity: 0.7;
}

.cr-dynamic-block__icon svg {
  width: 14px;
  height: 14px;
}

/* Gallery grid */
.cr-media__grid {
  display: grid;
  gap: var(--cr-spacing-sm);
}

.cr-media__grid--cols-2 {
  grid-template-columns: repeat(2, 1fr);
}

.cr-media__grid--cols-3 {
  grid-template-columns: repeat(3, 1fr);
}

.cr-media__grid--cols-4 {
  grid-template-columns: repeat(4, 1fr);
}

.cr-media__grid--cols-5 {
  grid-template-columns: repeat(5, 1fr);
}

.cr-media__grid--cols-6 {
  grid-template-columns: repeat(6, 1fr);
}

.cr-media__grid--auto {
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
}

/* Size variants */
.cr-media__grid--small .cr-media__item {
  aspect-ratio: 1;
  min-height: 60px;
}

.cr-media__grid--medium .cr-media__item {
  aspect-ratio: 1;
  min-height: 100px;
}

.cr-media__grid--large .cr-media__item {
  aspect-ratio: 1;
  min-height: 150px;
}

/* Gallery items */
.cr-media__item {
  position: relative;
  border-radius: var(--cr-radius-sm);
  overflow: hidden;
  cursor: pointer;
  border: 2px solid transparent;
  background: var(--background-secondary);
  transition:
    border-color 0.15s ease,
    transform 0.15s ease;
}

.cr-media__item:hover {
  border-color: var(--text-accent);
  transform: scale(1.02);
}

.cr-media__item--thumbnail {
  border-color: var(--color-green);
}

.cr-media__item--thumbnail:hover {
  border-color: var(--color-green);
}

/* Thumbnail badge */
.cr-media__badge {
  position: absolute;
  top: 4px;
  left: 4px;
  background: var(--color-green);
  color: var(--text-on-accent);
  font-size: 9px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  z-index: 2;
}

/* Image thumbnails */
.cr-media__image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Document placeholders */
.cr-media__item--doc {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--cr-spacing-sm);
}

.cr-media__doc-icon {
  color: var(--text-muted);
  opacity: 0.6;
  margin-bottom: var(--cr-spacing-xs);
}

.cr-media__doc-icon svg {
  width: 32px;
  height: 32px;
}

.cr-media__doc-name {
  font-size: 10px;
  color: var(--text-muted);
  text-align: center;
  word-break: break-word;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

/* Empty state */
.cr-media__empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--cr-spacing-lg);
  color: var(--text-muted);
  text-align: center;
  gap: var(--cr-spacing-sm);
}

.cr-media__empty-icon {
  opacity: 0.4;
}

.cr-media__empty-icon svg {
  width: 32px;
  height: 32px;
}

.cr-media__empty-text {
  font-size: var(--font-ui-small);
}

.cr-media__empty-hint {
  font-size: var(--font-ui-smaller);
  opacity: 0.7;
}

/* ==========================================================================
   Editable Mode (Drag-and-Drop Reordering)
   ========================================================================== */

/* Editable mode indicator */
.cr-media--editable {
  border: 1px dashed var(--text-accent);
  border-radius: var(--cr-radius-md);
}

.cr-media--editable .cr-media__item {
  cursor: grab;
}

.cr-media--editable .cr-media__item:active {
  cursor: grabbing;
}

/* Drag handle */
.cr-media__drag-handle {
  position: absolute;
  top: 4px;
  right: 4px;
  background: rgb(0 0 0 / 60%);
  color: #fff;
  padding: 4px;
  border-radius: 4px;
  opacity: 0;
  z-index: 3;
  transition: opacity 0.15s ease;
  pointer-events: none;
}

.cr-media--editable .cr-media__item:hover .cr-media__drag-handle {
  opacity: 1;
}

/* Dragging state */
.cr-media__item--dragging {
  opacity: 0.5;
  transform: scale(0.95);
}

/* Drop target highlight */
.cr-media__item--drag-over {
  border-color: var(--text-accent);
  box-shadow: 0 0 0 2px var(--text-accent);
}

/* ==========================================================================
   Frozen Gallery Callout
   ========================================================================== */

/* stylelint-disable selector-class-pattern -- Targets Obsidian's built-in .callout classes */

/*
 * Frozen gallery callout styling
 * Variables defined in variables.css, customizable via Style Settings plugin
 * Inspired by MCL Gallery Cards snippet
 */
.callout[data-callout-metadata="cr-frozen-gallery"] {
  padding: var(--cr-spacing-sm);
  background: var(--cr-gallery-background);
  border: none;
  box-shadow: none;
}

.callout[data-callout-metadata="cr-frozen-gallery"] .callout-title {
  display: none;
}

/* Flex gallery layout for images */
.callout[data-callout-metadata="cr-frozen-gallery"] .callout-content {
  display: flex;
  --callout-content-padding: 0;
  flex-wrap: wrap;
  gap: var(--cr-gallery-gap);
  margin: 0;
  padding: 0;
}

/* Paragraph containers within callout content */
.callout[data-callout-metadata="cr-frozen-gallery"] .callout-content > p {
  display: flex;
  flex-wrap: wrap;
  gap: var(--cr-gallery-gap);
  margin: 0;
}

/* Image embed containers */
.callout[data-callout-metadata="cr-frozen-gallery"] .callout-content .internal-embed.image-embed {
  display: block;
  line-height: 0;
}

/* Image styling with MCL-inspired features */
.callout[data-callout-metadata="cr-frozen-gallery"] .callout-content img {
  max-height: var(--cr-gallery-img-max-height);
  max-width: var(--cr-gallery-img-max-width);
  width: auto;
  height: auto;
  object-fit: var(--cr-gallery-object-fit);
  border-radius: var(--cr-gallery-img-border-radius);
  border: 1px solid var(--background-modifier-border);
  display: block;
  cursor: pointer;
  transition:
    transform 0.15s ease,
    box-shadow 0.15s ease;
}

/* Hover effect */
.callout[data-callout-metadata="cr-frozen-gallery"] .callout-content img:hover {
  transform: scale(1.03);
  box-shadow: 0 4px 12px rgb(0 0 0 / 15%);
  border-color: var(--text-accent);
}

/* Image zoom on click (hold) - MCL Gallery Cards feature */
.callout[data-callout-metadata="cr-frozen-gallery"] .callout-content img:active {
  cursor: zoom-out;
  display: block;
  background: rgb(0 0 0 / 80%);
  max-height: calc(100vh - 40px);
  max-width: calc(100vw - 40px);
  width: auto;
  height: auto;
  object-fit: contain;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000;
  border: none;
  border-radius: var(--cr-gallery-img-border-radius);
  box-shadow: 0 8px 32px rgb(0 0 0 / 50%);
}

/* stylelint-enable selector-class-pattern */

/* ==========================================================================
   Theme Compatibility
   ========================================================================== */

/* stylelint-disable-next-line selector-class-pattern -- Targets Obsidian's .theme-dark class */
.theme-dark .cr-dynamic-block {
  background: var(--background-secondary);
}
